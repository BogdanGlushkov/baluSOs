$(document).ready(function(){function a(a){d(n,m)||a.preventDefault()}function b(){var a=$(".structure-section.main label"),b=$(".summary-btn-save");a.qtip({content:$.localize_report('The "Body" part of the document is mandatory, it cannot be disabled.',"~/wwwroot/js/report/summary/summaryStructure.js"),style:{classes:"qtip-ux qtip-default qtip-multiline",tip:!0,width:270},position:{my:"top center",at:"bottom center"},show:{event:"mouseover"},hide:{event:"mouseout"}}),b.attr("disabled")&&b.qtip({content:$.localize_report("The button will become available after making changes to the list of sections of the document.","~/wwwroot/js/report/summary/summaryStructure.js"),style:{classes:"qtip-ux qtip-default qtip-multiline",tip:!0,width:270},position:{my:"top center",at:"bottom center",adjust:{y:5,x:0}},show:{event:"mouseover"},hide:{event:"mouseout"}})}function c(a){l=!0,k.show();var c="";null!=$userId&&(c+="&userId="+$userId),null!==$reportId&&(c+="&v="+$reportId),null!=$reportViewMode&&(c+="&viewMode="+$reportViewMode),null!=$validationHash&&(c+="&validationHash="+$validationHash),$shortLink&&(c+="&short=true"),c.length>0&&(c="?"+c.substring(1,c.length));var d="/api/v1/structures/documents/"+$documentId;null!=$structureVersion&&(d+="/versions/"+$structureVersion),d+=c,$.ajax({type:"GET",url:d,dataType:"json",contentType:"application/json; charset=utf-8",timeout:6e4,success:function(c,d){c&&($(".report-summary-structure").append(h(c.structure,a)),b(),jQuery(".summary-btn-save").bind("click",function(){setYMSummaryReportCounter("structure_save"),setGASummaryReportCounter("checkresults_structure","structure_save"),$(this).attr("disabled",!0);var a=$.toJSON({DocId:$documentId,IgnoredSections:n,UserId:$userId,ValidationHash:$validationHash,ViewMode:$summaryViewMode});$.ajax({type:"PUT",url:"/report/api/structure",data:a,dataType:"json",contentType:"application/json; charset=utf-8",timeout:6e4,success:function(a){var b=new DialogHelper;if(a.success){var c='<p class="complete">'+$.localize_report("All changes are saved","~/wwwroot/js/report/summary/summaryStructure.js")+"</p>\n<p>"+$.localize_report("The report will be rebuilt to reflect changes in the document structure","~/wwwroot/js/report/summary/summaryStructure.js")+"</p>";b.modalHtml(c,null,function(){f(a.link)})}else b.modalText($.localize_report("Failed to update structure.","~/wwwroot/js/report/summary/summaryStructure.js"),null,null,"ap-header-dialog"),$(".summary-btn-save").removeAttr("disabled")},error:function(a,b,c){var d=new DialogHelper;d.modalText($.localize_report("Failed to update structure.","~/wwwroot/js/report/summary/summaryStructure.js"),null,null,"ap-header-dialog"),$(".summary-btn-save").removeAttr("disabled")}})}),jQuery(".structure-sections-check-all input").bind("change",function(a){setYMSummaryReportCounter("structure_click_select_all"),setGASummaryReportCounter("checkresults_structure","click_select_all");var b=$(this).attr("checked");$(".structure-section input").each(function(){b?($(this).attr("checked","checked"),n=[]):"Main"!=$(this).attr("id")&&($(this).removeAttr("checked","checked"),n.includes($(this).attr("id"))||n.push($(this).attr("id")))}),e()}),jQuery(".structure-section-checkbox-wrap input").bind("change",function(){var a=$(this).attr("checked"),b=$(this).attr("id");setYMSummaryReportCounter("structure_click_"+b.toLowerCase()),setGASummaryReportCounter("checkresults_structure","click_"+b.toLowerCase()),a?n=n.filter(function(a){return a!=b}):n.includes(b)||n.push(b),e()})),l=!1,k.hide()},error:function(a,b,c){g(a)}})}function d(a,b){return a.length===b.length&&a.every(function(a){return b.includes(a)})}function e(){j&&!d(n,m)?$(".summary-btn-save").removeAttr("disabled"):$(".summary-btn-save").attr("disabled",!0)}function f(b){setYMSummaryReportCounter("structure_click_close"),setGASummaryReportCounter("checkresults_structure","structure_click_close"),window.removeEventListener("beforeunload",a),window.location.href=b}function g(a){401==a.status&&(window.location.href="/"),l=!1,k.hide();var b=404==a.status?$.localize_report("Structure is no longer available for this document","~/wwwroot/js/report/summary/summaryStructure.js"):$.localize_report("Failed to get structure info","~/wwwroot/js/report/summary/summaryStructure.js");$(".report-summary-structure").find("p.info").attr({"class":"error"}).text(b)}function h(a,b){function c(a,b,c){var d=c.filter(function(a){return a.type!=h}).length,e=a-d*b;return e/(c.length-d)}var d="",e=1===a.filter(function(a){return a.pageCount>0}).length;b&&("Default"==$reportViewMode?(d="/structure/document/"+$documentId+"/version/",null!=$structureVersion&&(d+=$structureVersion)):b=!1);var f='<div class="structure-info">\n';f+='<div class="structure-miniature-wrap">\n',b&&(f+='<a href="'+d+'" class="summary-btn-default" target="_blank">'+$.localize_report("Edit","~/wwwroot/js/report/summary/summaryStructure.js")+"</a>\n"),f+='<div class="structure-miniature">\n';var g=[];a.forEach(function(a){a.blocks.forEach(function(b){g.push({type:a.sectionType,startChar:b.startCharPosition})})});var h="Main",j=100,k=g.length<8?12.5:j/g.length,l=g.length<8?c(j,k,g):k;g.sort(function(a,b){return a.startChar-b.startChar}).forEach(function(a){var b=a.type==h?l:k,c=$("<div></div>",{"class":a.type.toLowerCase()});c.css({height:b+"%"}),f+=c.prop("outerHTML")}),f+="</div>\n",f+='<span class="structure-miniature-info">'+$.localize_report("Structure annotation","~/wwwroot/js/report/summary/summaryStructure.js")+"</span>\n",f+="</div>\n";var m=["Title","Content","Introduction","Method","Main","Conclusion","Bibliography","Appendix"],n=[];m.forEach(function(a,b){n[a]=b}),a.sort(function(a,b){return n[a.sectionType]-n[b.sectionType]}),f+='<div class="structure-sections">\n<div class="structure-sections-header">\n<h2>'+$.localize_report("Document section list","~/wwwroot/js/report/summary/summaryStructure.js")+"</h2>\n",e||(f+='<button class="summary-btn-save" disabled>'+$.localize_report("Save","~/wwwroot/js/report/summary/summaryStructure.js")+"</button>\n"),f+='<div class="structure-sections-check-all"><input type="checkbox" id="check-all"'+(e?"checked disabled":"")+'/>\n<label for="check-all">'+$.localize_report("Select all structure sections","~/wwwroot/js/report/summary/summaryStructure.js")+"</label>\n</div>\n",f+='<div class="structure-sections-list">\n';for(var o=0;o<a.length;o++)f+=i(a[o]);return f}function i(a){var b=!0,c=0,d='<div class="structure-section '+a.sectionType.toLowerCase()+'">\n';if(d+='<div class="structure-section-left">',"undefined"!=typeof $ignoredStructureSections&&$ignoredStructureSections&&(b=0==$ignoredStructureSections.filter(function(b){return b==a.sectionType}).length),d+='<div class="structure-section-checkbox-wrap">\n',a.pageCount>0&&(b||(n.push(a.sectionType),m.push(a.sectionType)),d+='<input type="checkbox" id="'+a.sectionType+'"'+(b?"checked":"")+" "+("Main"==a.sectionType?"disabled":"")+'/>\n<label for="'+a.sectionType+'"></label>\n'),d+="</div>\n",d+="<h3>"+$.localize_report(""+a.sectionType,"~/wwwroot/js/report/summary/summaryStructure.js")+"</h3>\n",d+="</div>\n",d+='<div class="structure-section-right">',a.pageCount>0){d+="<div><strong>"+$.localize_report("Number of pages","~/wwwroot/js/report/summary/summaryStructure.js")+":</strong> <span>"+a.pageCount+"</span></div>\n<div><strong>"+$.localize_report("On pages","~/wwwroot/js/report/summary/summaryStructure.js")+':</strong> <span class="page-nums">'+$.localize_report("p.","~/wwwroot/js/report/summary/summaryStructure.js");for(var e=0;e<a.blocks.length;e++)d+=a.blocks[e].startPage,a.blocks[e].startPage!=a.blocks[e].endPage&&(d+="-"+a.blocks[e].endPage),e!=a.blocks.length-1&&(d+=", "),c+=a.blocks[e].partOfDocumentAsPercent;d+="</span></div>\n<div><strong>"+$.localize_report("Percent by text","~/wwwroot/js/report/summary/summaryStructure.js")+":</strong> <span>"+roundWithDelimiter(100*c)+"%</span></div>\n"}else d+="<div>"+$.localize_report("not found","~/wwwroot/js/report/summary/summaryStructure.js")+"</div>\n";return d+="</div>\n",d+="</div>\n"}var j=$("#IsLast").length>0&&"true"===$("#IsLast").val().toLowerCase(),k=$(".report-summary-structure + .loading"),l=!1,m=[],n=[];if(k.loader({color:"white"}),$(".application-info > div a:eq(0)").click(function(a){a.preventDefault(),a.stopPropagation(),setYMSummaryReportCounter("structure_not_show_questionary"),setGASummaryReportCounter("checkresults_structure","not_show_questionary"),$.cookie("hideStructureApplication","1",{expires:365,path:"/"}),$(this).closest(".application-info").remove()}),$(".application-info > div a:eq(1)").click(function(a){setYMSummaryReportCounter("structure_fill_questionary"),setGASummaryReportCounter("checkresults_structure","fill_questionary")}),$("#loadStructureInfo").length>0){var o="True"===$("#loadStructureInfo").data("link");$("#loadStructureInfo").remove(),c(o)}window.addEventListener("beforeunload",a)});