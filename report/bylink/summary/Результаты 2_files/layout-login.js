var $loginReturnUrl=null;$(document).ready(function(){function a(){var a=null;q&&(a=grecaptcha.getResponse(f.find(".dialog-login .g-recaptcha").data("widgetid")));var b=$.toJSON({Email:$.trim(j.val()),Password:$.trim(k.val()),Captcha:a,ReturnUrl:$loginReturnUrl}),c=$("#__AjaxAntiForgeryForm").find("input[name='__RequestVerificationToken']").val();$.ajax({type:"POST",url:"/account/login",data:b,dataType:"json",beforeSend:function(a){a.setRequestHeader("X-RequestVerificationToken",c)},contentType:"application/json; charset=utf-8",success:function(a){q&&grecaptcha.reset(f.find(".dialog-login .g-recaptcha").data("widgetid")),a.success?(setYMMainCounter("login_email_complete"),setGAMainCounter("login_signin","login_email_complete"),setYMDefaultCounter("login_email_complete"),setGADefaultCounter("login_signin","login_email_complete"),null!=a.url?window.location.href=a.url:window.location.reload()):("invalid role"==a.status?h.html(a.message+" <a href='/student'>"+$.localize("Sign in","~/js/area/account/login.js")+"</a>").show():h.html(a.message).show(),m.removeAttr("disabled").text($.localize("Sign in","~/js/area/account/login.js"))),e=!1},error:function(a,b,c){e=!1,m.removeAttr("disabled").text($.localize("Sign in","~/js/area/account/login.js")),500==a.status&&window.location.reload(!0),f.dialog("close");var d=new DialogHelper;d.modalText($.localize("Sign in error.","~/js/area/account/login.js")),"ap-header-dialog"}})}function b(){var a=validateEmail($.trim(j.val()));null!=s&&(a?m.removeAttr("disabled"):m.attr("disabled","disabled")),j.toggleClass("ok",a)}function c(){e||(p.tabs("option","active",0),h.text("").hide(),i.text("").hide(),$(document).trigger("clearRegistrationErrors"),checkHeaderVarioqubFlag("social").then(function(a){updateSocialPosition(a),f.dialog("open")}))}function d(){if("function"==typeof window.URL){var a=window.history.location||window.location,b=new URL(a);b.searchParams.get("login")&&(c(),b.searchParams["delete"]("login"),history.replaceState(null,null,b))}}var e=!1,f=$("#dialog-enter"),g=f.find(".loading"),h=f.find(".dialog-login .alert-error"),i=f.find(".dialog-login .alert-success"),j=f.find('.dialog-login input[name^="Login.Email"]'),k=f.find('.dialog-login input[name^="Login.Password"]'),l=f.find("#tabs > ul > li:nth-child(2)"),m=f.find(".dialog-login .login-button > button"),n=f.find(".dialog-login #login-passwd-show"),o=$(".passwd-zone"),p=$(".dialog-enter #tabs"),q="undefined"!=typeof $showAccountCaptcha&&$showAccountCaptcha;$(document).on("click",".ap-dialog-enter-tabs .ui-tabs-nav li:eq(0)",function(a){setYMMainCounter("autho_form_to_registration")}),$(document).on("click",".ap-dialog-enter-tabs .ui-tabs-nav li:eq(0) .manual, .ap-dialog-enter .ui-dialog-title .manual",function(a){setYMMainCounter("autho_form_login_man"),setGAMainCounter("autho_form","login_manual")}),j.on("change",function(a){setYMMainCounter("autho_form_email_typing"),setGAMainCounter("login_form","email_typing")}),k.on("change",function(a){setYMMainCounter("autho_form_password_typing"),setGAMainCounter("login_form","password_typing")}),$(document).on("click",".ap-dialog-enter .ui-dialog-titlebar-close",function(){setYMMainCounter("autho_form_x"),setGAMainCounter("login_form","autho_form_x")}),p.length>=1&&p.tabs({active:0,activate:function(a,b){var c=b.newTab.index()+1;$("#tabs-"+c).find("input[type='text']:first").focus()}});var r=f.find("h3 > span");r.qtip({content:{text:function(a){var b=$(this).find("i").html();return b}},style:{classes:"qtip-ux qtip-field-dialog qtip-login ap-header-qtip",tip:!0},position:{my:"center left",at:"center right"},show:{solo:!0,event:"mouseover"},hide:{event:"mouseout",fixed:!0},events:{show:function(a,b){b.target.is(":hidden")&&a.preventDefault()}}});var s=r.qtip("api"),t=!1;f.dialog({autoOpen:!1,resizable:!1,modal:!0,draggable:!1,autoresize:!0,dialogClass:"ap-header-dialog ap-dialog-confirm "+(0==p.length?"ap-dialog-enter":"ap-dialog-enter-tabs"),buttons:[],open:function(){if(setYMMainCounter("login_signin_form_open"),setGAMainCounter("login_signin","login_signin_form_open"),setYMDefaultCounter("login_signin_form_open"),setGADefaultCounter("login_signin","login_signin_form_open"),m.removeAttr("disabled"),o.show(),l.css("pointer-events",""),0==p.length)j.focus();else{var a=p.tabs("option","active")+1;$("#tabs-"+a).find("input[type='text']:first").focus()}jQuery(".ui-widget-overlay").bind("click",function(){e||f.dialog("close")})},create:function(){q&&(m.on("captchaSuccess",a),m.on("captchaError",function(){h.text($.localize("Captcha error","~/js/area/account/login.js")).show(),m.removeAttr("disabled").text($.localize("Sign in","~/js/area/account/login.js")),e=!1}),m.on("captchaReset",function(){m.removeAttr("disabled").text($.localize("Sign in","~/js/area/account/login.js")),e=!1}))},beforeClose:function(){if(e)return!1},close:function(){$(document).trigger("clearLoginTab"),h.text("").hide(),i.text("").hide(),$(document).trigger("clearRegistrationTab"),$(document).trigger("clearRegistrationErrors"),$loginReturnUrl=null,g.hide(),null!=s&&s.hide(),q&&(f.find(".dialog-login .g-recaptcha").length>0&&grecaptcha.reset(f.find(".dialog-login .g-recaptcha").data("widgetid")),f.find(".dialog-registration .g-recaptcha").length>0&&grecaptcha.reset(f.find(".dialog-registration .g-recaptcha").data("widgetid")))},width:540,closeText:$.localize("Close","~/js/area/account/login.js")}),$(".enter .login, .start-free a, .section-access a.btn-submit-altr, .main-menu .enter-white").click(function(a){a.preventDefault(),a.stopPropagation(),e||($(this).is(".btn-submit-altr")?(setYMMainCounter("login_footer"),setGAMainCounter("login_signin","login","footer")):$(this).is(".login")?(setYMMainCounter("login_top"),setGAMainCounter("login_signin","login","top")):$(this).parent().is(".start-free")&&(setYMMainCounter("begin_for_free"),setGAMainCounter("login_signin","begin_for_free")),c())}),$(".ap-dialog-enter, .ap-dialog-enter-tabs").click(function(a){t&&(t=!1,a.target===r[0]&&a.stopPropagation())}),$(document).on("clearLoginTab",function(a){var b=$.parseJSON($.cookie("socialNewPlace"));null!=b&&b||(f.find(".dialog-registration form").show(),f.find(".social").show(),f.find(".dialog-registration .sniper-link-wrap").hide()),j.val("").removeClass("ok").focus(),k.val("").attr("type","password"),null!=s&&m.attr("disabled","disabled")}),$(document).on("openLoginDialog",function(a,b){var d=b||(a.originalEvent?a.originalEvent.detail:null);d&&($loginReturnUrl=d),c()}),m.click(function(b){if(b.preventDefault(),h.text("").hide(),i.text("").hide(),$(document).trigger("clearRegistrationTab"),$(document).trigger("clearRegistrationErrors"),!e)return setYMMainCounter("autho_form_apply"),setGAMainCounter("login_form","apply"),setYMDefaultCounter("autho_form_apply"),setGADefaultCounter("login_form","apply"),e=!0,m.attr("disabled","disabled").text($.localize("Signing in...","~/js/area/account/login.js")),q?grecaptcha.execute(f.find(".dialog-login .g-recaptcha").data("widgetid")):a(),!1}),f.find(".dialog-login").keypress(function(b){13==b.keyCode&&"textarea"!=b.target.type&&(b.preventDefault(),h.text("").hide(),i.text("").hide(),$(document).trigger("clearRegistrationErrors"),e||m.is(":disabled")||(e=!0,m.attr("disabled","disabled").text($.localize("Signing in...","~/js/area/account/login.js")),q?grecaptcha.execute(f.find(".dialog-login .g-recaptcha").data("widgetid")):a()))}),j.on("input",function(){e||b()}),j.on("blur",function(a){if(!e){var b=$(this),c=m.is(":disabled"),d=$.trim(b.val()).length,f=d>0&&c;t=f,null!=s&&s.toggle(f)}}),n.change(function(a){k.attr("type",$(this).is(":checked")?"text":"password"),setYMMainCounter("autho_form_show_password"),setGAMainCounter("login_form","show_password")}),d()});